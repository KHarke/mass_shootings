---
title:  "Preparing the TVP Mass Shooter Database"
author: "Tochi Agbara, Karen Harker, Kevin Brown"
editor: visual
---

## Correlational Analysis

Create data prep from correlational analysis.

For the correlation analysis there\'re currently 132 columns. We can deploy several methods to help with the analysis be more efficient and feature selection for future machine learning models.

Domain Knowledge: We can delete any columns that we know won't be useful for your research.

Missing Values: We can remove columns with a large number of missing values.

Variance Threshold: We can remove columns where most of the rows have the same values

Correlation: Wecan delete strongly correlated columns, as a result, our dataset will have less redundancy.

Model Feature Importance: Features that the model deems unnecessary can be deleted.

```{r}

library(readr)
library(dplyr)
library(ggplot2)
library(corrplot)
library(lubridate)
library(tidyr)
library(tidyverse)
library(GGally)
library(caret)

Full_Database<-read.csv("Full_database_VarCatHeaders.csv", header=TRUE)

head(Full_Database)
```

```{r}
# Domain Knowledge - remove columns not relevant to the problem

# Remove columns
columns_to_remove <- c("B_ShooterLastName", "B_ShooterFirstName", "D_FullDate", 
"D_DayofWeek", "D_Day", "D_Month", "D_Year", "L_StreetNumber", "L_StreetName", "L_City",
"L_County", "L_ZipCode", "L_Latitude", "L_Longitude", "L_StateCode", "L_Region",
"L_Location","L_InsiderorOutsider","L_WorkplaceShooting","L_MultipleLocations","L_OtherLocation","L_ArmedPersononScene","L_SpecifyArmedPerson",
"OB_Age", "OB_Gender", "OB_Race", "OB_Height", "OB_Weight", "OB_Immigrant",
"OB_SexualOrientation", "OB_Religion", "OB_Education", "OB_SchoolPerformance",
"OB_SchoolPerformanceSpecified", "OB_BirthOrder", "OB_NumberofSiblings", "OB_OlderSiblings",
"OB_YoungerSiblings", "OB_RelationshipStatus", "OB_Children", "OB_EmploymentStatus",
"OB_EmploymentType", "OB_MilitaryService", "OB_MilitaryBranch", "OB_CommunityInvolvement",
"OB_CommunityInvolvementSpecified", "CV_KnowntoPoliceorFBI", "CV_CriminalRecord",
"CV_PartICrimes", "CV_PartIICrimes", "CV_HighestLevelofJusticeSystemInvolvement",
"CV_HistoryofPhysicalAltercations", "CV_HistoryofAnimalAbuse", "CV_HistoryofDomesticAbuse",
"CV_DomesticAbuseSpecified", "CV_HistoryofSexualOffenses", "CV_GangAffiliation",
"CV_TerrorGroupAffiliation", "CV_KnownHateGrouporChatRoomAffiliation", "CV_ViolentVideoGames",
"CV_Bully", "TACE_Bullied", "TACE_RaisedbySingleParent", "TACE_ParentalDivorce_Separation",
"TACE_ParentalDeathinChildhood", "TACE_ParentalSuicide", "TACE_ChildhoodTrauma",
"TACE_PhysicallyAbused", "TACE_SexuallyAbused", "TACE_EmotionallyAbused", "TACE_Neglected",
"TACE_ChildhoodSES", "TACE_MotherViolentTreatment", "TACE_ParentalSubstanceAbuse",
"TACE_ParentCriminalRecord", "TACE_FamilyMemberIncarcerated", "TACE_AdultTrauma",
"SC_RecentorOngoingStressor", "SC_SignsofBeinginCrisis", "SC_TimelineofSignsofCrisis",
"SC_SignsofCrisisExpanded", "SC_InabilitytoPerformDailyTasks", "SC_NotablyDepressedMood",
"SC_UnusuallyCalmorHappy", "SC_RapidMoodSwings", "SC_IncreasedAgitation", "SC_AbusiveBehavior",
"SC_Isolation", "SC_LosingTouchwithReality", "SC_Paranoia", "HMH_Suicidality",
"HMH_PriorHospitalization", "HMH_VoluntaryorInvoluntaryHospitalization", "HMH_PriorCounseling",
"HMH_VoluntaryorMandatoryCounseling", "HMH_PsychiatricMedication", "HMH_PsychiatricMedicationSpecified",
"HMH_MedicationCategory", "HMH_Treatment6MonthsPriortoShooting", "HMH_MentalIllness",
"HMH_FASD_FetalAlcoholSpectrumDisorder", "HMH_KnownFamilyMentalHealthHistory", "HMH_AutismSpectrum",
"HMH_SubstanceUse", "HMH_HealthIssues", "HMH_HealthIssues_Specify", "HMH_HeadInjury_PossibleTBI",
"GM_KnownPrejudices", "GM_Motive_Racism_Xenophobia", "GM_Motive_ReligiousHate", "GM_Motive_Misogyny",
"GM_Motive_Homophobia", "GM_Motive_EmploymentIssue", "GM_Motive_EconomicIssue", "GM_Motive_LegalIssue",
"GM_Motive_RelationshipIssue", "GM_Motive_InterpersonalConflict", "GM_Motive_Fame_Seeking", "GM_Motive_Other",
"GM_Motive_Unknown", "GM_RoleofPsychosisintheShooting", "SOC_SocialMediaUse", "SOC_Leakage",
"SOC_LeakageHow", "SOC_LeakageWho", "SOC_LeakageSpecific_Nonspecific", "SOC_InterestinPastMassViolence",
"SOC_RelationshipwithOtherShootings", "SOC_SpecifyRelationshiptoOtherShootings", "SOC_LegacyToken",
"SOC_PopCultureConnection", "SOC_SpecifyPopCultureConnection", "SOC_Planning", "SOC_Performance",
"W_InterestinFirearms", "W_FirearmProficiency", "W_TotalFirearmsBroughttotheScene", "W_OtherWeaponsorGear",
"W_SpecifyOtherWeaponsorGear", "RC_OnSceneOutcome", "RC_WhoKilledShooterOnScene", "RC_AttempttoFlee",
"RC_InsanityDefense", "RC_CriminalSentence")

Full_Database <- Full_Database %>% select(-one_of(columns_to_remove))

```

```{r}


# Missing Values - remove columns with more than 50% missing values
Missing_values_cols_to_remove <- colnames(Full_Database)[colMeans(is.na(Full_Database)) > 0.5]
Full_Database <- Full_Database %>% select(-one_of(Missing_values_cols_to_remove))


```

```{r}


# Variance Threshold - remove columns with low variance
numeric_vars <- Full_Database %>% select_if(is.numeric)
low_variance_cols <- names(numeric_vars)[sapply(numeric_vars, var, na.rm = TRUE) < 0.1]
Full_Database <- Full_Database %>% select(-one_of(low_variance_cols))


```

```{r}

# Correlation - remove one of each pair of highly correlated variables
# Step 1: Identify numeric variables, because correlation can only be calculated for numeric variables
numeric_vars <- Full_Database %>% select_if(is.numeric)

# Step 2: Compute correlation matrix
correlation_matrix <- cor(numeric_vars, use = "complete.obs")  # only compute for complete observations

# Step 3: Visualize the correlation matrix
# Before running this, ensure corrplot package is installed. If not, install it using: install.packages('corrplot')
corrplot(correlation_matrix, method = "color", addCoef.col = "black")
# Step 4: Identify highly correlated variables

highly_correlated <- findCorrelation(correlation_matrix, cutoff = 0.7)  # here 0.7 is the absolute correlation coefficient above which variables are considered highly correlated

highly_correlated_vars <- colnames(numeric_vars)[highly_correlated]

highly_correlated <- findCorrelation(correlation_matrix, cutoff = 0.7)
highly_correlated_vars <- colnames(numeric_vars)[highly_correlated]

#print(highly_correlated)

# Step 3: Visualize the correlation matrix
corrplot(correlation_matrix, method = "color", addCoef.col = "black")


# Step 5: Remove one of the pair of highly correlated variables from your data
selected_features <- Full_Database %>% select(-one_of(highly_correlated_vars))

# Now selected_features dataset contains your selected features for further analysis

Full_Database <- Full_Database %>% select(-one_of(highly_correlated_vars))






```

```{r}


head(Full_Database)
```

## Data Modeling

```{r}

```

## Cluster Analysis

```{r}

```

## Boot strapping

```{r}

```

## Data Reporting & Communication Results

## 
